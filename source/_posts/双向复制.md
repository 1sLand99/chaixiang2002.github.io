## 需求

客户端与云机双向复制

### 核心

```java
ClipboardManager clipboard = (ClipboardManager) getSystemService(CLIPBOARD_SERVICE);
clipboard.addPrimaryClipChangedListener(new ClipboardManager.OnPrimaryClipChangedListener() {
    @Override
    public void onPrimaryClipChanged() {
        ClipData clip = clipboard.getPrimaryClip();
        if (clip != null && clip.getItemCount() > 0) {
            CharSequence copiedText = clip.getItemAt(0).getText();
            // 发送copiedText到宿主机
        }
    }
});

```



- ./frameworks/base/core/java/com/android/internal/space/NineDSpaceManager.java:28:    public static final String STATUS_CLIPBOARD = "**clipboard_chanaged**";
- ./vendor/ntimespace/Space9dService/src/com/android/server/SystemInfo.java:6:import static com.android.internal.space.NineDSpaceManager.**STATUS_CLIPBOARD**;
  ./vendor/ntimespace/Space9dService/src/com/android/server/SystemInfo.java:118:                        **mListener**.onInfoChanged(STATUS_CLIPBOARD, bundle);

startListener(SystemInfoListener **listener**) 



- vendor/ntimespace/Space9dService/src/com/android/server/MessageHandler.java

mInfo.startListener(this);

vendor/ntimespace/Space9dService/src/com/android/server/SystemInfo.java

public interface SystemInfoListener

vendor/ntimespace/Space9dService/src/com/android/server/MessageHandler.java

public class MessageHandler implements ServerSocket.MessageListener, SystemInfo.SystemInfoListener

public void onInfoChanged(String action, Bundle bundle) {







## clipboard_chanaged从执行流向下延申

> **frameworks/base/core/java/com/android/internal/space/NineDSpaceManager.java**

  public static final String STATUS_CLIPBOARD = "**clipboard_chanaged**";

> **vendor/ntimespace/Space9dService/src/com/android/server/SystemInfo.java**

import static com.android.internal.space.NineDSpaceManager.**STATUS_CLIPBOARD**;

public void startListener(SystemInfoListener listener) {...

this.mListener = listener;

...

mListener.onInfoChanged(**STATUS_CLIPBOARD**, bundle);

...}

  private **SystemInfoListener** mListener;

> **vendor/ntimespace/Space9dService/src/com/android/server/MessageHandler.java**

public class MessageHandler implements ServerSocket.MessageListener, SystemInfo.**SystemInfoListener** {

  public void **onInfoChanged**(String action, Bundle bundle) {

mService.**sendTracking**(action, bundle);

}